{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\Aditya Raj Awasthi\\\\Desktop\\\\bomb-dashboard-final-task\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{useCallback,useEffect,useState}from'react';import{useDispatch}from'react-redux';import{useWallet}from'use-wallet';import useDebounce from'../../hooks/useDebounce';import useIsWindowVisible from'../../hooks/useIsWindowVisible';import{updateBlockNumber}from'./actions';import{getDefaultProvider}from'../../utils/provider';export default function Updater(){var _useWallet=useWallet(),ethereum=_useWallet.ethereum,chainId=_useWallet.chainId;var dispatch=useDispatch();var windowVisible=useIsWindowVisible();var _useState=useState({chainId:chainId,blockNumber:null}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var blockNumberCallback=useCallback(function(blockNumber){setState(function(state){if(chainId===state.chainId){if(typeof state.blockNumber!=='number')return{chainId:chainId,blockNumber:blockNumber};return{chainId:chainId,blockNumber:Math.max(blockNumber,state.blockNumber)};}return state;});},[chainId,setState]);// attach/detach listeners\n// @ts-ignore\nuseEffect(function(){if(!ethereum||!chainId||!windowVisible)return undefined;setState({chainId:chainId,blockNumber:null});var provider=getDefaultProvider();provider.getBlockNumber().then(blockNumberCallback).catch(function(error){return console.error(\"Failed to get block number for chainId: \".concat(chainId),error);});provider.on('block',blockNumberCallback);return function(){return provider.removeListener('block',blockNumberCallback);};},[dispatch,chainId,ethereum,blockNumberCallback,windowVisible]);var debouncedState=useDebounce(state,100);useEffect(function(){if(!debouncedState.chainId||!debouncedState.blockNumber||!windowVisible)return;dispatch(updateBlockNumber({chainId:debouncedState.chainId,blockNumber:debouncedState.blockNumber}));},[windowVisible,dispatch,debouncedState.blockNumber,debouncedState.chainId]);return null;}","map":{"version":3,"names":["useCallback","useEffect","useState","useDispatch","useWallet","useDebounce","useIsWindowVisible","updateBlockNumber","getDefaultProvider","Updater","_useWallet","ethereum","chainId","dispatch","windowVisible","_useState","blockNumber","_useState2","_slicedToArray","state","setState","blockNumberCallback","Math","max","undefined","provider","getBlockNumber","then","catch","error","console","concat","on","removeListener","debouncedState"],"sources":["C:/Users/Aditya Raj Awasthi/Desktop/bomb-dashboard-final-task/src/state/application/updater.ts"],"sourcesContent":["import {useCallback, useEffect, useState} from 'react';\nimport {useDispatch} from 'react-redux';\nimport {useWallet} from 'use-wallet';\nimport useDebounce from '../../hooks/useDebounce';\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible';\nimport {updateBlockNumber} from './actions';\nimport {getDefaultProvider} from '../../utils/provider';\n\nexport default function Updater(): null {\n  const {ethereum, chainId} = useWallet();\n\n  const dispatch = useDispatch();\n\n  const windowVisible = useIsWindowVisible();\n\n  const [state, setState] = useState<{\n    chainId: number | undefined;\n    blockNumber: number | null;\n  }>({\n    chainId,\n    blockNumber: null,\n  });\n\n  const blockNumberCallback = useCallback(\n    (blockNumber: number) => {\n      setState((state) => {\n        if (chainId === state.chainId) {\n          if (typeof state.blockNumber !== 'number') return {chainId, blockNumber};\n          return {chainId, blockNumber: Math.max(blockNumber, state.blockNumber)};\n        }\n        return state;\n      });\n    },\n    [chainId, setState],\n  );\n\n  // attach/detach listeners\n  // @ts-ignore\n  useEffect(() => {\n    if (!ethereum || !chainId || !windowVisible) return undefined;\n    setState({chainId, blockNumber: null});\n\n    const provider = getDefaultProvider();\n    provider\n      .getBlockNumber()\n      .then(blockNumberCallback)\n      .catch((error) => console.error(`Failed to get block number for chainId: ${chainId}`, error));\n\n    provider.on('block', blockNumberCallback);\n    return () => provider.removeListener('block', blockNumberCallback);\n  }, [dispatch, chainId, ethereum, blockNumberCallback, windowVisible]);\n\n  const debouncedState = useDebounce(state, 100);\n\n  useEffect(() => {\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return;\n    dispatch(\n      updateBlockNumber({\n        chainId: debouncedState.chainId,\n        blockNumber: debouncedState.blockNumber,\n      }),\n    );\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId]);\n\n  return null;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}