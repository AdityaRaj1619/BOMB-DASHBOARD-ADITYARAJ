{"ast":null,"code":"import { useCallback, useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { useWallet } from 'use-wallet';\nimport useDebounce from '../../hooks/useDebounce';\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible';\nimport { updateBlockNumber } from './actions';\nimport { getDefaultProvider } from '../../utils/provider';\nexport default function Updater() {\n  const {\n    ethereum,\n    chainId\n  } = useWallet();\n  const dispatch = useDispatch();\n  const windowVisible = useIsWindowVisible();\n  const [state, setState] = useState({\n    chainId,\n    blockNumber: null\n  });\n  const blockNumberCallback = useCallback(blockNumber => {\n    setState(state => {\n      if (chainId === state.chainId) {\n        if (typeof state.blockNumber !== 'number') return {\n          chainId,\n          blockNumber\n        };\n        return {\n          chainId,\n          blockNumber: Math.max(blockNumber, state.blockNumber)\n        };\n      }\n      return state;\n    });\n  }, [chainId, setState]);\n\n  // attach/detach listeners\n  // @ts-ignore\n  useEffect(() => {\n    if (!ethereum || !chainId || !windowVisible) return undefined;\n    setState({\n      chainId,\n      blockNumber: null\n    });\n    const provider = getDefaultProvider();\n    provider.getBlockNumber().then(blockNumberCallback).catch(error => console.error(`Failed to get block number for chainId: ${chainId}`, error));\n    provider.on('block', blockNumberCallback);\n    return () => provider.removeListener('block', blockNumberCallback);\n  }, [dispatch, chainId, ethereum, blockNumberCallback, windowVisible]);\n  const debouncedState = useDebounce(state, 100);\n  useEffect(() => {\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return;\n    dispatch(updateBlockNumber({\n      chainId: debouncedState.chainId,\n      blockNumber: debouncedState.blockNumber\n    }));\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId]);\n  return null;\n}","map":{"version":3,"names":["useCallback","useEffect","useState","useDispatch","useWallet","useDebounce","useIsWindowVisible","updateBlockNumber","getDefaultProvider","Updater","ethereum","chainId","dispatch","windowVisible","state","setState","blockNumber","blockNumberCallback","Math","max","undefined","provider","getBlockNumber","then","catch","error","console","on","removeListener","debouncedState"],"sources":["C:/Users/Aditya Raj Awasthi/Desktop/bomb-dashboard-final-task/src/state/application/updater.ts"],"sourcesContent":["import {useCallback, useEffect, useState} from 'react';\nimport {useDispatch} from 'react-redux';\nimport {useWallet} from 'use-wallet';\nimport useDebounce from '../../hooks/useDebounce';\nimport useIsWindowVisible from '../../hooks/useIsWindowVisible';\nimport {updateBlockNumber} from './actions';\nimport {getDefaultProvider} from '../../utils/provider';\n\nexport default function Updater(): null {\n  const {ethereum, chainId} = useWallet();\n\n  const dispatch = useDispatch();\n\n  const windowVisible = useIsWindowVisible();\n\n  const [state, setState] = useState<{\n    chainId: number | undefined;\n    blockNumber: number | null;\n  }>({\n    chainId,\n    blockNumber: null,\n  });\n\n  const blockNumberCallback = useCallback(\n    (blockNumber: number) => {\n      setState((state) => {\n        if (chainId === state.chainId) {\n          if (typeof state.blockNumber !== 'number') return {chainId, blockNumber};\n          return {chainId, blockNumber: Math.max(blockNumber, state.blockNumber)};\n        }\n        return state;\n      });\n    },\n    [chainId, setState],\n  );\n\n  // attach/detach listeners\n  // @ts-ignore\n  useEffect(() => {\n    if (!ethereum || !chainId || !windowVisible) return undefined;\n    setState({chainId, blockNumber: null});\n\n    const provider = getDefaultProvider();\n    provider\n      .getBlockNumber()\n      .then(blockNumberCallback)\n      .catch((error) => console.error(`Failed to get block number for chainId: ${chainId}`, error));\n\n    provider.on('block', blockNumberCallback);\n    return () => provider.removeListener('block', blockNumberCallback);\n  }, [dispatch, chainId, ethereum, blockNumberCallback, windowVisible]);\n\n  const debouncedState = useDebounce(state, 100);\n\n  useEffect(() => {\n    if (!debouncedState.chainId || !debouncedState.blockNumber || !windowVisible) return;\n    dispatch(\n      updateBlockNumber({\n        chainId: debouncedState.chainId,\n        blockNumber: debouncedState.blockNumber,\n      }),\n    );\n  }, [windowVisible, dispatch, debouncedState.blockNumber, debouncedState.chainId]);\n\n  return null;\n}\n"],"mappings":"AAAA,SAAQA,WAAW,EAAEC,SAAS,EAAEC,QAAQ,QAAO,OAAO;AACtD,SAAQC,WAAW,QAAO,aAAa;AACvC,SAAQC,SAAS,QAAO,YAAY;AACpC,OAAOC,WAAW,MAAM,yBAAyB;AACjD,OAAOC,kBAAkB,MAAM,gCAAgC;AAC/D,SAAQC,iBAAiB,QAAO,WAAW;AAC3C,SAAQC,kBAAkB,QAAO,sBAAsB;AAEvD,eAAe,SAASC,OAAOA,CAAA,EAAS;EACtC,MAAM;IAACC,QAAQ;IAAEC;EAAO,CAAC,GAAGP,SAAS,EAAE;EAEvC,MAAMQ,QAAQ,GAAGT,WAAW,EAAE;EAE9B,MAAMU,aAAa,GAAGP,kBAAkB,EAAE;EAE1C,MAAM,CAACQ,KAAK,EAAEC,QAAQ,CAAC,GAAGb,QAAQ,CAG/B;IACDS,OAAO;IACPK,WAAW,EAAE;EACf,CAAC,CAAC;EAEF,MAAMC,mBAAmB,GAAGjB,WAAW,CACpCgB,WAAmB,IAAK;IACvBD,QAAQ,CAAED,KAAK,IAAK;MAClB,IAAIH,OAAO,KAAKG,KAAK,CAACH,OAAO,EAAE;QAC7B,IAAI,OAAOG,KAAK,CAACE,WAAW,KAAK,QAAQ,EAAE,OAAO;UAACL,OAAO;UAAEK;QAAW,CAAC;QACxE,OAAO;UAACL,OAAO;UAAEK,WAAW,EAAEE,IAAI,CAACC,GAAG,CAACH,WAAW,EAAEF,KAAK,CAACE,WAAW;QAAC,CAAC;MACzE;MACA,OAAOF,KAAK;IACd,CAAC,CAAC;EACJ,CAAC,EACD,CAACH,OAAO,EAAEI,QAAQ,CAAC,CACpB;;EAED;EACA;EACAd,SAAS,CAAC,MAAM;IACd,IAAI,CAACS,QAAQ,IAAI,CAACC,OAAO,IAAI,CAACE,aAAa,EAAE,OAAOO,SAAS;IAC7DL,QAAQ,CAAC;MAACJ,OAAO;MAAEK,WAAW,EAAE;IAAI,CAAC,CAAC;IAEtC,MAAMK,QAAQ,GAAGb,kBAAkB,EAAE;IACrCa,QAAQ,CACLC,cAAc,EAAE,CAChBC,IAAI,CAACN,mBAAmB,CAAC,CACzBO,KAAK,CAAEC,KAAK,IAAKC,OAAO,CAACD,KAAK,CAAE,2CAA0Cd,OAAQ,EAAC,EAAEc,KAAK,CAAC,CAAC;IAE/FJ,QAAQ,CAACM,EAAE,CAAC,OAAO,EAAEV,mBAAmB,CAAC;IACzC,OAAO,MAAMI,QAAQ,CAACO,cAAc,CAAC,OAAO,EAAEX,mBAAmB,CAAC;EACpE,CAAC,EAAE,CAACL,QAAQ,EAAED,OAAO,EAAED,QAAQ,EAAEO,mBAAmB,EAAEJ,aAAa,CAAC,CAAC;EAErE,MAAMgB,cAAc,GAAGxB,WAAW,CAACS,KAAK,EAAE,GAAG,CAAC;EAE9Cb,SAAS,CAAC,MAAM;IACd,IAAI,CAAC4B,cAAc,CAAClB,OAAO,IAAI,CAACkB,cAAc,CAACb,WAAW,IAAI,CAACH,aAAa,EAAE;IAC9ED,QAAQ,CACNL,iBAAiB,CAAC;MAChBI,OAAO,EAAEkB,cAAc,CAAClB,OAAO;MAC/BK,WAAW,EAAEa,cAAc,CAACb;IAC9B,CAAC,CAAC,CACH;EACH,CAAC,EAAE,CAACH,aAAa,EAAED,QAAQ,EAAEiB,cAAc,CAACb,WAAW,EAAEa,cAAc,CAAClB,OAAO,CAAC,CAAC;EAEjF,OAAO,IAAI;AACb"},"metadata":{},"sourceType":"module"}